{
  "pluginType": "DB",
  "pluginId": "postgres-plugin",
  "unpublishedAction": {
    "name": "get_sales_summary",
    "datasource": {
      "name": "Logistics_db",
      "pluginId": "postgres-plugin",
      "messages": [],
      "isAutoGenerated": false,
      "id": "Logistics_db",
      "deleted": false,
      "policies": [],
      "userPermissions": []
    },
    "pageId": "OrdersSummary",
    "actionConfiguration": {
      "timeoutInMillisecond": 10000,
      "paginationType": "NONE",
      "encodeParamsToggle": true,
      "body": "\n\nWITH Query1 AS (\n    SELECT \n        SUM(p.\"Amount\") as \"Total Cost (LocalCurrency)\",\n        p2.\"Currency\",\n  SUM(CASE WHEN p2.\"Currency\" = 'CAD' THEN p.\"Amount\" / {{appsmith.store.currency.CAD}}\n           WHEN p2.\"Currency\" = 'GBP' THEN p.\"Amount\" / {{appsmith.store.currency.GBP}}\n\t\t\t\t\t WHEN p2.\"Currency\" = 'AUD' THEN p.\"Amount\" / {{appsmith.store.currency.AUD}}\n           ELSE p.\"Amount\" END) as \"Total Cost (ConvertedToUSD)\",\n  c1.\"CustomerName\" as \"ClientName\"\n    FROM \"public\".\"Invoice\" i \n        INNER JOIN \"public\".\"PrinterLineItems\" p ON ( p.\"InvoiceID\" = i.\"InvoiceID\"  )  \n        INNER JOIN \"public\".\"PrinterPrice\" p1 ON ( p1.\"Id\" = p.\"PrinterPriceID\"  )  \n        INNER JOIN \"public\".\"Printers\" p2 ON ( p2.\"Id\" = p1.\"PrinterID\"  )  \n        INNER JOIN \"public\".\"Customers\" c1 ON ( c1.\"Id\" = i.\"CustomerID\"  )  \n   WHERE  to_date(cast(i.\"InvoiceDate\" as TEXT),'YYYY-MM-DD') >= DATE '{{moment(DatePicker1.selectedDate).format(\"YYYY-MM-DD\")}}' AND to_date(cast(i.\"InvoiceDate\" as TEXT),'YYYY-MM-DD') <= DATE '{{moment(DatePicker2.selectedDate).format(\"YYYY-MM-DD\")}}'\n    GROUP BY \n        c1.\"CustomerName\", p2.\"Currency\"\n),\nQuery2 AS (\n    SELECT \n        SUM(c.\"Amount\") as \"Total Cost (LocalCurrency income)\",\n        p2.\"Currency\" as \"currencyIncome\",\n        SUM(CASE \n                WHEN   i.\"InvoiceStatus\" ='PAID' THEN c.\"Amount\"\n                ELSE 0\n            END) as \"Total Cost PAID\",\n\t        SUM(CASE \n                WHEN p2.\"Currency\" = 'CAD' AND i.\"InvoiceStatus\" !='PAID' THEN c.\"Amount\" \n                WHEN p2.\"Currency\" = 'GBP' AND i.\"InvoiceStatus\" !='PAID' THEN c.\"Amount\" \n                WHEN p2.\"Currency\" = 'AUD' AND i.\"InvoiceStatus\" !='PAID' THEN c.\"Amount\"\n                ELSE 0\n            END) as \"Total Cost (income ConvertedToUSD)\",\n        c1.\"CustomerName\" as \"ClientName\"\n    FROM \"public\".\"Invoice\" i \n        INNER JOIN \"public\".\"CustomerLineItems\" c ON ( c.\"InvoiceID\" = i.\"InvoiceID\"  )  \n        INNER JOIN \"public\".\"Printers\" p2 ON ( p2.\"PrinterName\" = c.\"Printer\"  )  \n        INNER JOIN \"public\".\"Customers\" c1 ON ( c1.\"Id\" = i.\"CustomerID\"  )  \n    WHERE  to_date(cast(i.\"InvoiceDate\" as TEXT),'YYYY-MM-DD') >= DATE '{{moment(DatePicker1.selectedDate).format(\"YYYY-MM-DD\")}}' AND to_date(cast(i.\"InvoiceDate\" as TEXT),'YYYY-MM-DD') <= DATE '{{moment(DatePicker2.selectedDate).format(\"YYYY-MM-DD\")}}'\n    GROUP BY \n        c1.\"CustomerName\", p2.\"Currency\"\n)\nSELECT \n    COALESCE(q1.\"ClientName\", q2.\"ClientName\") as \"ClientName\",\n    COALESCE(q1.\"Currency\", q2.\"currencyIncome\") as \"Currency\",\n    COALESCE(q1.\"Total Cost (LocalCurrency)\", 0) as \"Total Cost (LocalCurrency)\",\n    COALESCE(q1.\"Total Cost (ConvertedToUSD)\", 0) as \"Total Cost (ConvertedToUSD)\",\n    COALESCE(q2.\"Total Cost (LocalCurrency income)\", 0) as \"Total Cost (LocalCurrency income)\",\n    COALESCE(q2.\"Total Cost (income ConvertedToUSD)\", 0) as \"Total Cost (income ConvertedToUSD)\",\n\t\tCOALESCE(q2.\"Total Cost PAID\", 0) as \"Total Cost PAID\"\nFROM \n    Query1 q1\nFULL OUTER JOIN \n    Query2 q2 ON q1.\"ClientName\" = q2.\"ClientName\" AND q1.\"Currency\" = q2.\"currencyIncome\"\nORDER BY \n    LOWER(COALESCE(q1.\"ClientName\", q2.\"ClientName\")) ASC;\n",
      "selfReferencingDataPaths": [],
      "pluginSpecifiedTemplates": [
        {
          "value": false
        }
      ]
    },
    "executeOnLoad": true,
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "isValid": true,
    "invalids": [],
    "messages": [],
    "jsonPathKeys": [
      "appsmith.store.currency.AUD",
      "appsmith.store.currency.CAD",
      "appsmith.store.currency.GBP",
      "moment(DatePicker1.selectedDate).format(\"YYYY-MM-DD\")",
      "moment(DatePicker2.selectedDate).format(\"YYYY-MM-DD\")"
    ],
    "userSetOnLoad": false,
    "confirmBeforeExecute": false,
    "policies": [],
    "userPermissions": [],
    "createdAt": "2023-11-17T17:54:18Z"
  },
  "id": "OrdersSummary_get_sales_summary",
  "deleted": false,
  "gitSyncId": "63b393c7f276cd0745e9510c_6557a8caeb046a5ba543b8b5"
}