{
  "pluginType": "DB",
  "pluginId": "postgres-plugin",
  "unpublishedAction": {
    "name": "Query2",
    "datasource": {
      "name": "Logistics_db",
      "pluginId": "postgres-plugin",
      "messages": [],
      "isAutoGenerated": false,
      "id": "Logistics_db",
      "deleted": false,
      "policies": [],
      "userPermissions": []
    },
    "pageId": "LogSum",
    "actionConfiguration": {
      "timeoutInMillisecond": 10000,
      "paginationType": "NONE",
      "encodeParamsToggle": true,
      "body": "WITH full_customer_items AS (\n\tSELECT \"CustomerLineItems\".\"Id\", p1.\"ProductDescription\", \"CustomerLineItems\".\"Qty\", \"CustomerLineItems\".\"Amount\", CustomerLineItems\".\"SubItemID\" FROM \"CustomerLineItems\"\n\tLEFT JOIN \"CustomerPrice\" c1 ON (\"CustomerLineItems\".\"CustomerPriceID\" = c1.\"Id\")\n\tLEFT JOIN \"Products\" p1 ON (c1.\"ProductID\" = p1.\"Id\")\n),\nmain_items AS (\n\tSELECT * FROM full_customer_items WHERE \"SubItemID\" IS NULL\n),\nsub_items AS (\n\tSELECT * FROM full_customer_items WHERE \"SubItemID\" IS NOT NULL\n),\nitem_qty_combo AS (\n\tSELECT\n\t t1.\"Id\" AS \"Id\",\n\tt1.\"Qty\" AS \"Qty\",\n\t(SELECT \"QTY\" FROM sub_items t2 WHERE t2.\"SubItemID\" = t1.\"Id\" AND t2.\"ProductDescription\" ILIKE '%Extra%' OR t2.\"ProductDescription\" ILIKE '%add%') AS SubQty\n),\n\ttotal_amount AS (\nSELECT SUM(\"Amount\") AS total FROM full_customer_items\n)\nSELECT\nCOALESCE(full_customer_items.\"SubItemID\", full_customer_items.\"Id\") as \"Id\",\nstring_agg(\n    CASE\n      WHEN p.\"ProductDescription\" ILIKE '%Extra%' OR p.\"ProductDescription\" ILIKE '%add%'\n      THEN\n        '(' || q.\"Qty\" / it.\"Qty\" || ') ' || p.\"ProductDescription\"\n      ELSE\n        p.\"ProductDescription\"\n      END, ' âž¤ '\n) as \"OrderDetails\",\nSUM(it.\"Amount\") as \"Summary\"\nFROM full_customer_items it\nJOIN \"public\".\"CustomerPrice\" c2 ON (it.\"CustomerPriceID\" = c2.\"Id\")\nJOIN \"public\".\"Products\" p ON (p.\"Id\" = c2.\"ProductID\")\nJOIN item_qty_combo q ON (q.\"Id\" = it.\"Id\")\nGROUP BY COALESCE(it.\"SubItemID\", it.\"Id\")\nORDER BY \"Id\"\n\n",
      "selfReferencingDataPaths": [],
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ]
    },
    "executeOnLoad": false,
    "dynamicBindingPathList": [],
    "isValid": true,
    "invalids": [],
    "messages": [],
    "jsonPathKeys": [],
    "userSetOnLoad": false,
    "confirmBeforeExecute": false,
    "policies": [],
    "userPermissions": []
  },
  "id": "LogSum_Query2",
  "deleted": false,
  "gitSyncId": "64c9416ee7b8e74ccd45fed9_64c9511c2f7abd633ccc1889"
}